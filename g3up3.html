<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Catch the Birthday Guy</title>
<style>
  body {
    margin: 0;
    overflow: hidden;
    font-family: Arial, sans-serif;
  }
  #gameCanvas {
    background: #f0f0f0;
    display: block;
  }
  #startScreen {
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    background: rgba(0,0,0,0.85);
    color: white;
    font-size: 2em;
    z-index: 1000;
    text-align: center;
    padding: 20px;
  }
  #settingsPanel {
    position: absolute;
    top: 50%;
    right: 0;
    transform: translateY(-50%);
    background: rgba(255,255,255,0.9);
    padding: 10px;
    border-radius: 10px 0 0 10px;
    font-size: 14px;
	 z-index: 4; 
  }
  #settingsPanel label {
    display: block;
    margin-top: 10px;
	 z-index: 3; 
  }
  #muteBtn {
    margin-top: 15px;
    background: #333;
    color: #fff;
    border: none;
    padding: 5px;
    cursor: pointer;
    border-radius: 5px;
	 z-index: 3; 
  }
  #restartBtn {
    display: none;
    position: absolute;
    bottom: 50%;
    left: 50%;
    transform: translate(-50%, 50%);
    background: #28a745;
    color: #fff;
    font-size: 1.5em;
    padding: 15px 30px;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    z-index: 1500;
  }
  #backgroundText {
    position: absolute;
    width: 100%;
    top: 40%;
    text-align: center;
    font-size: 80px;
    font-weight: bold;
    color: rgba(255, 200, 0, 0.2); /* semi-transparent */
    pointer-events: none; /* doesn’t block clicks */
    user-select: none;
    z-index: 0;
}
</style>
</head>
<body>
<div id="startScreen">
  <div>Catch the Birthday Guy! 🥳</div>
  <small style="font-size: 0.6em;">Move your mouse to chase. Press ENTER to start.</small>
</div>
<canvas id="gameCanvas"></canvas>
<div id="backgroundText">🎉 Happy Birthday Abhi! 🎉</div>
<div id="settingsPanel">
  <label>Speed: <input type="range" id="speedControl" min="2" max="8" value="3"></label>
  <label>Group Size: <input type="range" id="groupSizeControl" min="5" max="50" value="15"></label>
  <button id="muteBtn">Mute</button>
</div>

<button id="restartBtn">Restart</button>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let gameStarted = false;
let speedFactor = 3;
let groupSize = 15;
let isMuted = false;

const birthdayEmoji = '🥳';
const birthdayTransformEmoji = '🍸'; // vodka bottle
const otherEmojis = ['😀','😎','😃','🙂','😉','😊'];

let birthdayGuy = { x: 200, y: 200, size: 50, dx: 2, dy: 2, hideTimer: 0 };
let group = [];
let mouse = { x: canvas.width / 2, y: canvas.height / 2 };
let gameTimer = 0;
let caught = false;

let explosions = [];

const catchSound = new Audio('https://www.soundjay.com/button/sounds/button-3.mp3');
const explosionSound = new Audio('https://www.soundjay.com/button/sounds/button-16.mp3');

function createGroup() {
  group = [];
  for (let i = 0; i < groupSize; i++) {
    group.push({
      x: Math.random() * canvas.width,
      y: Math.random() * canvas.height,
      dx: (Math.random() - 0.5) * 4,
      dy: (Math.random() - 0.5) * 4,
      size: 50
    });
  }
}

function startGame() {
  gameStarted = true;
  caught = false;
  explosions = [];
  document.getElementById('startScreen').style.display = 'none';
  document.getElementById('restartBtn').style.display = 'none';
  createGroup();
  birthdayGuy = { x: 200, y: 200, size: 50, dx: 3, dy: 3, hideTimer: 0 };
  gameTimer = 0;
  gameLoop();
}

document.addEventListener('keydown', (e) => {
  if (e.key === 'Enter' && !gameStarted) {
    startGame();
  }
});

canvas.addEventListener('mousemove', (e) => {
  mouse.x = e.clientX;
  mouse.y = e.clientY;
});

document.getElementById('speedControl').addEventListener('input', (e) => {
  speedFactor = parseInt(e.target.value);
});

document.getElementById('groupSizeControl').addEventListener('input', (e) => {
  groupSize = parseInt(e.target.value);
  createGroup();
});

document.getElementById('muteBtn').addEventListener('click', () => {
  isMuted = !isMuted;
  document.getElementById('muteBtn').textContent = isMuted ? 'Unmute' : 'Mute';
});

document.getElementById('restartBtn').addEventListener('click', startGame);

function updatePositions() {
  gameTimer += 1/60;

  if (gameTimer >= 30) {
    birthdayGuy.isVodka = true;
  }

  let dx = mouse.x - birthdayGuy.x;
  let dy = mouse.y - birthdayGuy.y;
  let dist = Math.sqrt(dx * dx + dy * dy);

  if (dist < 200) {
    birthdayGuy.dx *= 1.02;
    birthdayGuy.dy *= 1.02;
  }

  birthdayGuy.x += birthdayGuy.dx * speedFactor;
  birthdayGuy.y += birthdayGuy.dy * speedFactor;

  if (birthdayGuy.x < 0 || birthdayGuy.x > canvas.width) birthdayGuy.dx *= -1;
  if (birthdayGuy.y < 0 || birthdayGuy.y > canvas.height) birthdayGuy.dy *= -1;

  group.forEach(member => {
    let gx = mouse.x - member.x;
    let gy = mouse.y - member.y;
    let gdist = Math.sqrt(gx * gx + gy * gy);
    if (gdist < 200) {
      member.dx *= 1.01;
      member.dy *= 1.01;
    }
    member.x += member.dx * (speedFactor - 1);
    member.y += member.dy * (speedFactor - 1);

    if (member.x < 0 || member.x > canvas.width) member.dx *= -1;
    if (member.y < 0 || member.y > canvas.height) member.dy *= -1;
  });

  if (!caught && dist < 50) {
    onCaught();
  }
}

function onCaught() {
 
  vargames++;
  if (!isMuted) catchSound.play();
  startExplosion(birthdayGuy.x, birthdayGuy.y);
  if(vargames==5){
   caught = true;
  setTimeout(() => {
    document.getElementById('restartBtn').style.display = 'block';
    gameStarted = false;
  }, 5000);} // delay for explosion animation
}

function startExplosion(x, y) {
  if (!isMuted) explosionSound.play();
  const emojis = ['🎉','🎂','🎁','🥳','🍾','🎊'];
  for (let i = 0; i < 30; i++) {
    explosions.push({
      emoji: emojis[Math.floor(Math.random() * emojis.length)],
      x: x,
      y: y,
      dx: (Math.random() - 0.5) * 10,
      dy: (Math.random() - 0.5) * 10,
      life: 100
    });
  }
}

function updateExplosions() {
  explosions.forEach(exp => {
    exp.x += exp.dx;
    exp.y += exp.dy;
    exp.dy += 0.2; // gravity
    exp.life -= 2;
  });
  explosions = explosions.filter(exp => exp.life > 0);
}

function drawExplosions() {
  ctx.font = '40px Arial';
  explosions.forEach(exp => {
    ctx.globalAlpha = exp.life / 100;
    ctx.fillText(exp.emoji, exp.x, exp.y);
    ctx.globalAlpha = 1;
  });
}

function catchBirthdayGuy(e) {
    catchCount++;
    playSound(catchSound);
    triggerExplosion(e.clientX, e.clientY);

    if (catchCount >= 5) {
        finalExplosion(e.clientX, e.clientY);
        endGame();
    } else {
        repositionBirthdayGuy();
    }
}

function drawCharacters() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.font = '50px Arial';
  if (!caught) {
    let emojiToShow = birthdayGuy.isVodka ? birthdayTransformEmoji : birthdayEmoji;
    ctx.fillText(emojiToShow, birthdayGuy.x, birthdayGuy.y);
  }
  group.forEach(member => {
    ctx.fillText(otherEmojis[Math.floor(Math.random() * otherEmojis.length)], member.x, member.y);
  });
}
let vargames=0
function gameLoop() {
  if (!gameStarted && vargames==5 &&explosions.length === 0) return;
  if (gameStarted) {
    updatePositions();
    drawCharacters();
  } else {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
  }
  updateExplosions();
  drawExplosions();
  requestAnimationFrame(gameLoop);
}
</script>
</body>
</html>
